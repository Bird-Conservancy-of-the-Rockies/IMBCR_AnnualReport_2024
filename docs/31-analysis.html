<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Appendix D — Data Analysis – Integrated Monitoring in Bird Conservation Regions</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./30-protocol-changes.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./28-rmadc.html">Appendices</a></li><li class="breadcrumb-item"><a href="./31-analysis.html"><span class="chapter-number">D</span>&nbsp; <span class="chapter-title">Data Analysis</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="./index.html" class="sidebar-logo-link">
      <img src="./figures/BCR-logo.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="./">2024 IMBCR Field Season Report</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Home</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2-about-us.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">About Us</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./3-exec-summary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Executive Summary</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./4-tables-figures.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Tables and Figures</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./5-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./6-methods.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Methods</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Results</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./7-results.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Summary</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./8-usfs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">U.S. Forest Service</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./9-blm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Bureau of Land Management</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-dod.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Department of Defense</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-nps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">National Park Service</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-tribal.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Tribal Lands</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-bcr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Bird Conservation Regions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14-co.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Colorado</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15-ks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Kansas</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16-mt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Montana</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17-ne.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Nebraska</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./18-nd.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">North Dakota</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./19-ok.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Oklahoma</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./20-sd.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">South Dakota</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./21-tx.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Texas</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./22-ut.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Utah</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./23-wy.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Wyoming</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Discussion</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./24-applications.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Data Applications</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./25-special-feature.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Special Feature - Conservation &amp; Management</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./26-conclusion.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Conclusions</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./27-references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./28-rmadc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Rocky Mountain Avian Data Center Tips</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./29-history.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">IMBCR Program and Stratification History</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./30-protocol-changes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Protocol Changes Over Time</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./31-analysis.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">D</span>&nbsp; <span class="chapter-title">Data Analysis</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#statistical-models" id="toc-statistical-models" class="nav-link active" data-scroll-target="#statistical-models"><span class="header-section-number">D.1</span> Statistical Models</a>
  <ul class="collapse">
  <li><a href="#indices" id="toc-indices" class="nav-link" data-scroll-target="#indices">Indices</a></li>
  <li><a href="#abundance-model" id="toc-abundance-model" class="nav-link" data-scroll-target="#abundance-model">Abundance model</a></li>
  <li><a href="#sec-occupancy" id="toc-sec-occupancy" class="nav-link" data-scroll-target="#sec-occupancy">Occupancy model</a></li>
  <li><a href="#trend-estimation" id="toc-trend-estimation" class="nav-link" data-scroll-target="#trend-estimation">Trend estimation</a></li>
  <li><a href="#sec-plotsize" id="toc-sec-plotsize" class="nav-link" data-scroll-target="#sec-plotsize">Plot size</a></li>
  <li><a href="#model-selection" id="toc-model-selection" class="nav-link" data-scroll-target="#model-selection">Model selection</a></li>
  <li><a href="#sec-modelfitting" id="toc-sec-modelfitting" class="nav-link" data-scroll-target="#sec-modelfitting">Model fitting</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./28-rmadc.html">Appendices</a></li><li class="breadcrumb-item"><a href="./31-analysis.html"><span class="chapter-number">D</span>&nbsp; <span class="chapter-title">Data Analysis</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Appendix D — Data Analysis</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="statistical-models" class="level2" data-number="D.1">
<h2 data-number="D.1" class="anchored" data-anchor-id="statistical-models"><span class="header-section-number">D.1</span> Statistical Models</h2>
<section id="indices" class="level3">
<h3 class="anchored" data-anchor-id="indices">Indices</h3>
<p>The following indices are used in all model descriptions:</p>
<p><span class="math inline">\(i\)</span> - strata with max <span class="math inline">\(I\)</span></p>
<p><span class="math inline">\(j\)</span> - grid cells with max <span class="math inline">\(J\)</span></p>
<p><span class="math inline">\(k\)</span> - points within a grid cell with max <span class="math inline">\(K=16\)</span>, and <span class="math inline">\(K_{[s]}\)</span> is the number of points surveyed in grid cell <span class="math inline">\(j\)</span></p>
<p><span class="math inline">\(l\)</span> - Bird Conservation Regions with max <span class="math inline">\(L\)</span>; note that strata are nested with Bird Conservation Regions, so an index <span class="math inline">\(i\)</span> implies indexing by <span class="math inline">\(l\)</span>.</p>
<p><span class="math inline">\(d\)</span> - distance bins with max <span class="math inline">\(d_{[max]}=10\)</span></p>
<p><span class="math inline">\(d_{[mid]}\)</span>, <span class="math inline">\(d_{[low]}\)</span>, and <span class="math inline">\(d_{[high]}\)</span> are the distance mid-point, lower bound, and upper bound for distance bin <span class="math inline">\(d\)</span>. <span class="math inline">\(d_{[max,high]}\)</span> is the upper bound for the furthest distance bin (i.e., the radius of the entire point-level plot).</p>
<p><span class="math inline">\(r\)</span> – 2-min time removal bins within the 6-min survey with max <span class="math inline">\(R=3\)</span></p>
<p><span class="math inline">\(t\)</span> – years with max <span class="math inline">\(T\)</span></p>
<p><span class="math inline">\(m\)</span> – posterior samples</p>
</section>
<section id="abundance-model" class="level3">
<h3 class="anchored" data-anchor-id="abundance-model">Abundance model</h3>
<p>We modeled abundance and occupancy using separate models. We describe the abundance model here and subsequently describe the occupancy model.</p>
<section id="state-process" class="level4">
<h4 class="anchored" data-anchor-id="state-process">State process</h4>
<p>The abundance model includes a sub-model quantifying occupancy of grid cells, upon which abundance is conditioned (i.e., we estimate abundance within occupied grid cells).</p>
<p><span id="eq-abundance_z"><span class="math display">\[z_{ijt} \sim Bernoulli(ψ_{it}) \tag{D.1}\]</span></span></p>
<center>
and
</center>
<p><span id="eq-abundance_psi"><span class="math display">\[logit(ψ_{it}) \sim Normal(μ_{[ψ],t},SD_{[ψ],t}^{2}), \tag{D.2}\]</span></span></p>
<p>where <span class="math inline">\(ψ_{it}\)</span> is the probability of species occupancy of a grid cell in stratum <span class="math inline">\(i\)</span> in year <span class="math inline">\(t\)</span>, <span class="math inline">\(z_{ijt}\)</span> is the latent occupancy state of grid cell <span class="math inline">\(j\)</span> in stratum <span class="math inline">\(i\)</span> during year <span class="math inline">\(t\)</span>, and <span class="math inline">\(μ_{[ψ],t}\)</span> and <span class="math inline">\(SD_{[ψ],t}^{2}\)</span> are year-specific mean and variance hyper-parameters. We exclude data for all strata in which the species was never detected (effectively conditioning occupancy on being within the species range). We model abundance of independent clusters of individuals within <span class="math inline">\(d_{[max,high]}\)</span> of points within an occupied grid cell as</p>
<p><span id="eq-abundance_N"><span class="math display">\[N_{ijt} \sim Poisson(λ_{ijt}×z_{ijt}) \tag{D.3}\]</span></span></p>
<center>
and
</center>
<p><span id="eq-abundance_lambda"><span class="math display">\[log(λ_{ijt})=α_{it}+ε_{jt}. \tag{D.4}\]</span></span></p>
<p>where <span class="math inline">\(α_{it}\)</span> and <span class="math inline">\(ε_{jt}\)</span> are stratum- and grid-cell-specific random effects, respectively, and <span class="math inline">\(α_{it}\)</span> is also subject to a fixed effect of year:</p>
<p><span id="eq-abundance_alpha"><span class="math display">\[α_{it} \sim Normal(μ_{[α],t},SD_{[α],t}^{2}) \tag{D.5}\]</span></span></p>
<center>
and
</center>
<p><span id="eq-abundance_epsilon"><span class="math display">\[ε_{it} \sim Normal(0,SD_{[ε]}^{2}). \tag{D.6}\]</span></span></p>
<p>We estimated <span class="math inline">\(SD_{[α],t}\)</span> and <span class="math inline">\(SD_{[ε]}\)</span> with gamma priors. For <span class="math inline">\(SD_{[α],t}\)</span>, we used a completely uninformed <span class="math inline">\(gamma(1,1)\)</span> prior. For <span class="math inline">\(SD_{[ε]}\)</span>, we used a somewhat informed <span class="math inline">\(gamma(1.015117, 3.807330)\)</span> prior based on the distribution of posterior estimates of this parameter across species from earlier analysis. We derive density, D, as</p>
<p><span id="eq-abundance_D"><span class="math display">\[D_{ijt}= \frac{N_{ijt}× \hat{\bar{s}}}{K×∑_{d=1}^{d_{[max]}}A_{d}}, \tag{D.7}\]</span></span></p>
<p>where <span class="math inline">\(K×∑_{d=1}^{d_{[max]}}A_{d}\)</span> is the effective area (<span class="math inline">\(km^{2}\)</span>) of estimation for a grid cell and <span class="math inline">\(\hat{\bar{s}}\)</span> is the estimated mean size for independent clusters, which is sampled from the distribution</p>
<p><span id="eq-abundance_s"><span class="math display">\[\hat{\bar{s}} \sim Normal(\hat{\mu_{s}},\hat{SE_s}), \tag{D.8}\]</span></span></p>
<p>where <span class="math inline">\(\hat{\mu_s}=Mean(s)\)</span> and <span class="math inline">\(\hat{SE_s}=SD(s)/\sqrt{n}\)</span>, in which <span class="math inline">\(s\)</span> represents observed cluster sizes and <span class="math inline">\(n\)</span> is the number of independent clusters detected. We derive stratum-level density estimates by averaging all <span class="math inline">\(D_{ijt}\)</span> within each stratum, and we take the area-weighted average of strata estimates to obtain superstrata density and occupancy estimates.</p>
</section>
<section id="observation-process" class="level4">
<h4 class="anchored" data-anchor-id="observation-process">Observation process</h4>
<p>We model the sum of observed counts (of independent clusters of individuals) across all points surveyed within a grid cell (<span class="math inline">\(n_{ijt}\)</span>) as</p>
<p><span id="eq-abundance_n"><span class="math display">\[n_{ijt} \sim Binomial\biggl(N_{ijt},p_{[a],tl}×p_{[p],t}×\biggl(\frac{K_{[s],ijt}}{K}\biggr)\biggr), \tag{D.9}\]</span></span></p>
<p>where <span class="math inline">\(p_{[a],tl}\)</span> is a year- and BCR-specific availability component of detection probability, <span class="math inline">\(p_{[p],t}\)</span> is a year-specific perceptibility component of detection probability, and <span class="math inline">\(K_{[s],ijt}⁄K\)</span> is survey effort. Detection components can be expressed as the sum of probability vectors:</p>
<p><span id="eq-abundance_p_a"><span class="math display">\[p_{[a],tl}=∑_{r=1}^{R} π_{[a],tlr} \tag{D.10}\]</span></span></p>
<center>
and
</center>
<p><span id="eq-abundance_p_p"><span class="math display">\[p_{[p],tl}=∑_{d=1}^{d_{max}} π_{[p],tld}, \tag{D.11}\]</span></span></p>
<p>where <span class="math inline">\(π_{[a],tlr}\)</span> and <span class="math inline">\(π_{[p],tld}\)</span> are detection probabilities within time removal and distance bins (hereafter bin probabilities), respectively. We model the distribution of counted individuals among time removal and distance bins, respectively, as</p>
<p><span id="eq-abundance_pi_a"><span class="math display">\[\mathbf{y_{[a],ijt}} \sim Multinomial \biggl(n_{ijt},\mathbf{π_{[a],tl}^{[c]}} \biggr) \tag{D.12}\]</span></span></p>
<center>
and
</center>
<p><span id="eq-abundance_pi_p"><span class="math display">\[\mathbf{y_{[p],ijt}} \sim Multinomial \biggl(n_{ijt},\mathbf{π_{[p],tl}^{[c]}} \biggr), \tag{D.13}\]</span></span></p>
<p>where <span class="math inline">\(\mathbf{y_{[a],ijt}}\)</span> and <span class="math inline">\(\mathbf{y_{[p],ijt}}\)</span> are vectors of counts within time removal and distance bins. Bin probabilities for availability assume constant availability across the survey period,</p>
<p><span id="eq-abundance_pi_a_cell"><span class="math display">\[π_{[a],trl}=p_{[ar],tl} (1-p_{[ar],tl})^{r-1}, \tag{D.14}\]</span></span></p>
<p>where <span class="math inline">\(p_{[ar],tl}\)</span> is the availability for a single 2-min time removal bin. Bin probabilities for perceptibility account for area of bins with increasing distance,</p>
<p><span id="eq-abundance_pi_p_cell"><span class="math display">\[π_{[p],td}=\frac{p_{[pd],td}A_d}{∑_{d=1}^{d_{[max]}}A_d},~\mathrm{and} \tag{D.15}\]</span></span></p>
<p>where <span class="math inline">\(p_{[pd],td}\)</span> is the perceptibility within distance bin <span class="math inline">\(d\)</span> in year <span class="math inline">\(t\)</span>, and <span class="math inline">\(A_d\)</span> is the area of distance bin <span class="math inline">\(d\)</span>. Multinomial cell probabilites for modeling <span class="math inline">\(\mathbf{y_{[a],ijt}}\)</span> and <span class="math inline">\(\mathbf{y_{[p],ijt}}\)</span> represent bin probabilites scaled to sum to 1:</p>
<p><span id="eq-abundance_pi_a_cell_c"><span class="math display">\[π_{[a],trl}^{[c]}=π_{[a],trl}⁄p_{[a],tl}, \tag{D.16}\]</span></span></p>
<center>
and
</center>
<p><span id="eq-abundance_pi_p_cell_c"><span class="math display">\[π_{[p],td}^{[c]}=π_{[p],td}⁄p_{[p],t}. \tag{D.17}\]</span></span></p>
<p>Surveys in 2008-2009 were 5 min instead of 6 min in length, so for these years, we calculate the availability for a 1-min interval, <span class="math inline">\(p_{[a1],tl}=1-\biggl((1-p_{[ar],tl})^3\biggr)^{1/6}\)</span>, and then calculate the unscaled cell probability for the third (1 min) period as <span class="math inline">\(π_{[a],(t≤2)(r=3)l}=p_{[a1],tl}×(1-p_{[ar],tl})^{r-1}\)</span>. We model <span class="math inline">\(p_{[pd],td}\)</span> using one of four possible perceptibility models: 1) a half-normal constant model, 2) a hazard rate constant model, 3) a half-normal year model, and 4) a hazard rate year model. For half-normal functions, we calculated <span class="math inline">\(p_{[pd],td}\)</span> for each distance class as:</p>
<p><span id="eq-abundance_p_pd_HN"><span class="math display">\[p_{[pd],td}=\frac{2\pi\int_{c=d_{[low]}}^{c=d_{[high]}}exp\biggl(-\biggl(\frac{c^2}{2\sigma_{t^2}}\biggr)\biggr)c~dc}{A_d}, \tag{D.18}\]</span></span></p>
<p>where <span class="math inline">\(d_{[low]}\)</span> and <span class="math inline">\(d_{[high]}\)</span> are the bounds for distance bin <span class="math inline">\(d\)</span> and <span class="math inline">\(σ_t\)</span> is the half-normal shape parameter. Because of the lack of an analytical solution to the integral of the hazard rate function, we calculated <span class="math inline">\(p_{[pd],td}\)</span> at the midpoint, <span class="math inline">\(d_{[mid]}\)</span>, of each distance class:</p>
<p><span id="eq-abundance_p_pd_HZ"><span class="math display">\[p_{[pd],td}=1-exp\biggl(-\biggl(\frac{d_{[mid]}}{h_t}\biggr)^b\biggr), \tag{D.19}\]</span></span></p>
<p>where <span class="math inline">\(h_t\)</span> and <span class="math inline">\(b\)</span> are estimated parameters for the hazard function. For perceptibility models (<a href="#eq-abundance_p_pd_HN" class="quarto-xref">Equation&nbsp;<span>D.18</span></a> and <a href="#eq-abundance_p_pd_HZ" class="quarto-xref">Equation&nbsp;<span>D.19</span></a>), we draw year-specific shape parameters from hyperdistributions:</p>
<p><span id="eq-abundance_HN_sigma"><span class="math display">\[log(σ_t) \sim Normal(μ_{[σ]},SD_{[σ]}^2), \tag{D.20}\]</span></span></p>
<p><span id="eq-abundance_HZ_h"><span class="math display">\[log(h_t) \sim Normal(μ_{[h]},SD_{[h]}^2). \tag{D.21}\]</span></span></p>
<p>We allowed availability to vary by year and BCR:</p>
<p><span id="eq-abundance_p_ar"><span class="math display">\[logit(p_{[ar],tl}) \sim Normal(μ_{[p_{ar}]},SD_{[p_{ar}]}^2). \tag{D.22}\]</span></span></p>
<p>Priors for annual variation in detectability components are</p>
<p><span id="eq-abundance_mu_sigma"><span class="math display">\[μ_{[σ]} \sim Normal(4.5,1.5), \tag{D.23}\]</span></span></p>
<p><span id="eq-abundance_mu_h"><span class="math display">\[μ_{[h]} \sim Normal(4.5,1.5), \tag{D.24}\]</span></span></p>
<p><span id="eq-abundance_mu_par"><span class="math display">\[μ_{[p_{ar}]} \sim Normal(0,1), \tag{D.25}\]</span></span></p>
<center>
and
</center>
<p><span id="eq-abundance_SD_sigma_h_par"><span class="math display">\[SD_{[σ]},SD_{[h]},SD_{[p_{ar}]} \sim gamma(1,1). \tag{D.26}\]</span></span></p>
</section>
</section>
<section id="sec-occupancy" class="level3">
<h3 class="anchored" data-anchor-id="sec-occupancy">Occupancy model</h3>
<p>We describe here the occupancy model, which estimates occupancy of points conditioned on occupancy of grid cells.</p>
<section id="state-process-1" class="level4">
<h4 class="anchored" data-anchor-id="state-process-1">State process</h4>
<p>We model species occupancy of grid cells in the same manner as for the abundance model (<a href="#eq-abundance_z" class="quarto-xref">Equation&nbsp;<span>D.1</span></a>, <a href="#eq-abundance_psi" class="quarto-xref">Equation&nbsp;<span>D.2</span></a>). We model species occupancy of points within an occupied grid cell as</p>
<p><span id="eq-occupancy_u"><span class="math display">\[u_{ijt}|z_{ijt} \sim Binomial(K,θ_{it}×z_{ijt}) \tag{D.27}\]</span></span></p>
<center>
and
</center>
<p><span id="eq-occupancy_theta"><span class="math display">\[logit(θ_{it}) \sim Normal(μ_{[θ],t},SD_{[θ],t}^{2}), \tag{D.28}\]</span></span></p>
<p>where <span class="math inline">\(θ_{it}\)</span> is the probability of species occupancy of a point within an occupied grid cell in stratum <span class="math inline">\(i\)</span> and year <span class="math inline">\(t\)</span>, <span class="math inline">\(u_{ijt}\)</span> is the latent occupancy state describing the number of points occupied within grid cell <span class="math inline">\(j\)</span>, stratum <span class="math inline">\(i\)</span>, and year <span class="math inline">\(t\)</span>, and <span class="math inline">\(μ_{[θ],t}\)</span> and <span class="math inline">\(SD_{[θ],t}^{2}\)</span> are year-specific mean and variance hyper-parameters.</p>
</section>
<section id="observation-process-1" class="level4">
<h4 class="anchored" data-anchor-id="observation-process-1">Observation process</h4>
<p>We model species detections at points using</p>
<p><span id="eq-occupancy_y"><span class="math display">\[y_{ijt} \sim Binomial\biggl(u_{ijt},p_{tl}×\biggl(\frac{K_{[s],ijt}}{K}\biggr)\biggr), \tag{D.29}\]</span></span></p>
<p>with <span class="math inline">\(p_{tl}\)</span> is a year- and BCR-specific detection probability and <span class="math inline">\(K_{[s],ijt}⁄K\)</span> is survey effort. Overall species detectability for a point survey, <span class="math inline">\(p_{tl}\)</span>, summarizes the probability vector</p>
<p><span id="eq-occupancy_p"><span class="math display">\[p_{tl}=∑_{r=1}^{R} \mathbf{π_{[R],tl}^{[c]}} \tag{D.30}\]</span></span></p>
<p>consisting of multinomial cell probabilities for</p>
<p><span id="eq-occupancy_y_R"><span class="math display">\[\mathbf{y_{[R],ijt}} \sim Multinomial \biggl(y_{ijtl}, \mathbf{π_{[R],tl}^{[c]}} \biggr), \tag{D.31}\]</span></span></p>
<p>where <span class="math inline">\(\mathbf{y_{[R],ijt}}\)</span> is a vector of representing the frequency of points where the species was detected across time removal bins when first detected. Cell probabilities for the time removal model assume constant detectability across the survey period,</p>
<p><span id="eq-occupancy_pi_R"><span class="math display">\[π_{[R],trl}=p_{[R],tl} (1-p_{[R],tl})^{r-1}, \tag{D.32}\]</span></span></p>
<p>and are scaled to sum to 1,</p>
<p><span id="eq-occupancy_pi_R_c"><span class="math display">\[π_{[R],trl}^{[c]}=π_{[R],trl}⁄p_{tl}, \tag{D.33}\]</span></span></p>
<p>where <span class="math inline">\(p_{[R],tl}\)</span> is species detectability for a single 2-min time removal bin. We model variability in species detectability here (<span class="math inline">\(p_{[R],tl}\)</span>) in the same manner as the availability component of the abundance model (<span class="math inline">\(p_{[ar]}\)</span> in <a href="#eq-abundance_p_ar" class="quarto-xref">Equation&nbsp;<span>D.22</span></a>, <a href="#eq-abundance_mu_par" class="quarto-xref">Equation&nbsp;<span>D.25</span></a>, and <a href="#eq-abundance_SD_sigma_h_par" class="quarto-xref">Equation&nbsp;<span>D.26</span></a>), including the shorter 5-min survey period in 2008-2009 (see explanation following <a href="#eq-abundance_pi_a_cell_c" class="quarto-xref">Equation&nbsp;<span>D.16</span></a>).</p>
</section>
</section>
<section id="trend-estimation" class="level3">
<h3 class="anchored" data-anchor-id="trend-estimation">Trend estimation</h3>
<p>We derived posterior estimates of occupancy and abundance trends for any strata or superstrata for desired time periods from strata or (rolled-up) superstrata estimates of occupancy or density, respectively. For stratum or superstratum <span class="math inline">\(i\)</span> we fitted a generalized linear model (GLM) to each posterior sample, m, of density or occupancy estimates:</p>
<p><span id="eq-trend_D"><span class="math display">\[log(\hat{D}_{itm}) \sim α_{[D],im}+r_{[D],im}×(t-1)~\mathrm{or} \tag{D.34}\]</span></span></p>
<p><span id="eq-trend_occ"><span class="math display">\[logit(\hat{ψ}_{itm}×\hat{θ}_{it}) \sim α_{[ψθ],im}+r_{[ψθ],im}×(t-1). \tag{D.35}\]</span></span></p>
<p>For occupancy, we multiplied <span class="math inline">\(ψ×θ\)</span> to derive the unconditional probability of a point being occupied by the species, and then derived trends. We retained the maximum likelihood estimate (MLE) of the slope, <span class="math inline">\(\tilde{r}_{im}\)</span>, which is equivalent to the least squares trend. We also retained the MLE of the intercept <span class="math inline">\(\tilde{α}_{im}\)</span>. We then summarized across <span class="math inline">\(m\)</span> to derive the posterior estimates for <span class="math inline">\(r\)</span> and predicted <span class="math inline">\(D\)</span> and <span class="math inline">\(ψ×θ\)</span>.</p>
</section>
<section id="sec-plotsize" class="level3">
<h3 class="anchored" data-anchor-id="sec-plotsize">Plot size</h3>
<p>Following established practice for distance sampling data (Buckland et al.&nbsp;2001:15, 151), we truncated detections for each species beyond the 90% quantile of recorded distances from the surveyor. The purpose of this practice is to improve the fit of the perceptibility curve by minimizing the influence of outliers on estimation (e.g., <span class="math inline">\(p_{[p],tl}\)</span> in <a href="#eq-abundance_p_p" class="quarto-xref">Equation&nbsp;<span>D.11</span></a>). The plot size for abundance estimation technically corresponds with truncation distance, but because density is abundance scaled by area, interpretation of density does not depend on plot size.</p>
<p>For occupancy, we truncated detections for most species at 125 m from survey points (i.e., half the distance between neighboring points). Ninety-five of the 358 species analyzed are typically detected at distances beyond 125 m such that truncating at this distance would entail excluding most detections. For these species, we truncated at 998 m. Occupancy describes the proportion of plots where at least one member of the species occurs (i.e., presence-absence of the species). As such, occupancy can be multipled by stratum area to estimate the area occupied, and plot size is the resolution for this quantity. For species with 125m radius plots, neighboring plots within a grid cell do not overlap, so estimation of area occupied is readily interpretable as the species range within the stratum. For species with 998m radius plots, neighboring plots can overlap, so a single individual can potentially occupy &gt; 1 plot. For these species, occupancy less readily interpretable as the species range and instead more clearly quantifies space use (Latif et al.&nbsp;2016). Occupancy estimates are not entirely comparable across species with different plot sizes. Nevertheless, large differences in occupancy should be ecologically meaningful. Trends in occupancy will also be comparable across species regardless of plot size. Additionally, trends in occupancy can be more clearly interpretable as changes in species range regardless of plot size, whereas trends in abundance may primarily reflect changes in population size.</p>
</section>
<section id="model-selection" class="level3">
<h3 class="anchored" data-anchor-id="model-selection">Model selection</h3>
<p>For each species, we considered alternative structures for the observation component of abundance and occupancy models in order to balance model fit, complexity, and computational efficiency. Because accounting for heterogeneity in bird observability is critical for accurate population estimation, we aimed to fit maximally complex observation models supported by the data. Moreover, because corrections to count data generated from distance sampling are relatively robust to heterogeneity (see pooling robustness in Buckland et al.&nbsp;2001:41-42), we prioritized allowing heterogeneity in availability over perceptibility for abundance models.</p>
<p>For abundance models, we first considered two potential functions for describing the decline in perceptibility of birds with distance from the surveyor: a half-normal model and a hazard model. We preliminarily fitted detection-only versions of these models to the raw distance data (i.e., distances not indexed by sampling unit or year). We used the Watanabe-Akaike Information Criterion (WAIC; Watanabe 2010, Hooten and Hobbs 2015) to select the most parsimonious perceptibility functional form and then retained that function for each species for modeling distance-based perceptibility in the primary analysis. We first considered the maximally complex abundance model (hereafter global abundance model), which included annual variation in both perceptibility and availability, and variability in availability among Bird Conservation Regions (<a href="#eq-abundance_HN_sigma" class="quarto-xref">Equation&nbsp;<span>D.20</span></a> - <a href="#eq-abundance_p_ar" class="quarto-xref">Equation&nbsp;<span>D.22</span></a>). If the global abundance model did not converge after a specified number of attempts (for details on model fitting, convergence, and MCMC sampling criteria, see <a href="#sec-modelfitting" class="quarto-xref"><span>Section D.1.7</span></a> below), we then considered a constant perceptibility abundance model, which replaced either <a href="#eq-abundance_HN_sigma" class="quarto-xref">Equation&nbsp;<span>D.20</span></a> and <a href="#eq-abundance_mu_sigma" class="quarto-xref">Equation&nbsp;<span>D.23</span></a> or <a href="#eq-abundance_HZ_h" class="quarto-xref">Equation&nbsp;<span>D.21</span></a> and <a href="#eq-abundance_mu_h" class="quarto-xref">Equation&nbsp;<span>D.24</span></a> with</p>
<p><span id="eq-constant_sigma"><span class="math display">\[log(σ) \sim Normal(4.5,1.5) \tag{D.36}\]</span></span></p>
<center>
or
</center>
<p><span id="eq-constant_h"><span class="math display">\[log(h) \sim Normal(4.5,1.5), \tag{D.37}\]</span></span></p>
<p>respectively. We successfully fitted models allowing variation in availability for all species, so we had no need of a constant availability model, even though we did initially consider it.</p>
<p>For occupancy models, we occasionally failed to achieve convergence when allowing detectability to vary among years and Bird Conservation Regions, in which case we fitted a constant-detectability model. Since detectability for occupancy models is analogous to the availability component in abundance models, the constant-detectability occupancy model replaces the equivalent of <a href="#eq-abundance_p_ar" class="quarto-xref">Equation&nbsp;<span>D.22</span></a>, <a href="#eq-abundance_mu_par" class="quarto-xref">Equation&nbsp;<span>D.25</span></a>, and <a href="#eq-abundance_SD_sigma_h_par" class="quarto-xref">Equation&nbsp;<span>D.26</span></a> with</p>
<p><span id="eq-constant_p"><span class="math display">\[logit(p) \sim Normal(0,1). \tag{D.38}\]</span></span></p>
</section>
<section id="sec-modelfitting" class="level3">
<h3 class="anchored" data-anchor-id="sec-modelfitting">Model fitting</h3>
<p>We performed all data processing, analysis, and derivation of estimates in R (R Core Team, 2023) and model fitting in Nimble (de Valpine et al.&nbsp;2017, 2023). All scripts for the annual analysis are maintained in a git repository and available upon request.</p>
<p>The R code automated combining strata-level population and trend estimates to derive superstrata estimates at multiple spatial scales, including quantification of estimation uncertainty. Additionally, we automated periodic checking of convergence and switching to alternative models in cases where more complex models failed to converge within a specified number of attempts.</p>
<p>Model fitting with Nimble entailed sampling model parameter space with 2 independent Markov Chain Monte Carlo (MCMC) chains. For each species, the automated process began sampling with chains of length = 10000 iterations, discarding the first 5000 as burn-in and retaining every 50th sample, then checked convergence of chains using the <span class="math inline">\(\hat{R}\)</span> metric and effective sample size using <span class="math inline">\(n_{effective}\)</span> (Gelman et al.&nbsp;2004). We required <span class="math inline">\(\hat{R}&lt;1.1\)</span> and <span class="math inline">\(n_{effective}\geq 20\)</span>, and continued sampling for another 10000 iterations until we either achieved these criteria or reached the maximum number of attempts, with an attempt being 10000 iterations and checks of <span class="math inline">\(\hat{R}\)</span> and <span class="math inline">\(n_{effective}\)</span> occurring after each attempt. We specified 50 max attempts for global abundance and occupancy models and no max for simpler alternatives.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./30-protocol-changes.html" class="pagination-link" aria-label="Protocol Changes Over Time">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Protocol Changes Over Time</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->




</body></html>